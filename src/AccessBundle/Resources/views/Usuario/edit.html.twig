{% extends 'AccessBundle:Default:layout.html.twig' %}

{% form_theme usuarioForm _self %}

{%- block form_errors -%}
  {%- if errors|length > 0 -%}
    {%- for error in errors -%}
      <small class="text-danger">{{ error.message }}</small>
    {%- endfor -%}
  {%- endif -%}
{%- endblock form_errors -%}


{% block content %}
  <div class="my-3 container-fluid bg-light border border-light">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
	<li class="breadcrumb-item"><a href="{{ url('usuario_list') }}">usuarios</a></li>
	<li class="breadcrumb-item active" aria-current="page">editar</li>
      </ol>
    </nav>

    <h2>Editar Usuario <strong class="text-info">@{{ usuario.username }}</strong></h2>

    {{ form_start(usuarioForm, {'attr': {'class': 'mb-5'}}) }}
      <h4>Cambiar Contraseña</h4>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">
	  {{ form_label(usuarioForm.oldPassword, 'Contraseña anterior') }}
	</div>
	<div class="col col-sm col-md-7 col-lg-4">
	  {{ form_widget(usuarioForm.oldPassword, {'attr': {'class': 'form-control'}}) }}
	  {{ form_errors(usuarioForm.oldPassword) }}
	</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">
	  {{ form_label(usuarioForm.newPassword.first, 'Nueva Contraseña') }}
	</div>
	<div class="col col-sm col-md-7 col-lg-4">
	  {{ form_widget(usuarioForm.newPassword.first, {'attr': {'class': 'form-control'}}) }}
	  {{ form_errors(usuarioForm.newPassword.first) }}
	</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">
	  {{ form_label(usuarioForm.newPassword.second, 'Repetir Nueva Contraseña') }}
	</div>
	<div class="col col-sm col-md-7 col-lg-4">
	  {{ form_widget(usuarioForm.newPassword.second, {'attr': {'class': 'form-control'}}) }}
	  {{ form_errors(usuarioForm.newPassword.second) }}
	</div>
      </div>

      <div class="form-row">
	<div class="col col-sm col-md-10 col-lg-6">
	  <input type="submit" class="btn btn-primary" value="Actualizar Contraseña"/>
	</div>
      </div>
    {{ form_end(usuarioForm) }}

    {{ form_start(personaForm, {'attr': {'class': 'mb-5'}}) }}
      <h4 class="">Datos Personales</h4>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.rut, 'Rut') }}</div>
	<div class="col col-sm col-md-7 col-lg-4">
	  {{ form_widget(personaForm.rut, {'attr': {'class': 'form-control w-auto d-inline', 'size': 10, 'value': persona.rut}}) }}
	  &ndash; {{ form_widget(personaForm.dv, {'attr': {'class': 'form-control w-auto w-md-50 d-inline ', 'size': 1}, 'value': persona.vrut}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.nombres) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.nombres, {'attr': {'class': 'form-control', 'value': persona.nombres}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.apellidopaterno) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.apellidopaterno, {'attr': {'class': 'form-control', 'value': persona.apellidopaterno}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.apellidomaterno) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.apellidomaterno, {'attr': {'class': 'form-control', 'value': persona.apellidomaterno}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.fecha_nacimiento) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.fecha_nacimiento, {'attr': {'class': 'form-control', 'value': persona.fechaNacimiento | date('Y-m-d')}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.nombre_calle, 'Dirección') }}</div>
	<div class="col col-sm col-md-7 col-lg-4 input-group">
	  {{ form_widget(personaForm.nombre_calle, {'attr': {'class': 'form-control w-auto', 'value': persona.nombreCalle}}) }}
	  &nbsp;
	  <div class="input-group-prepend">
	    <div class="input-group-text">#</div>
	  </div>
	  {{ form_widget(personaForm.numdirec, {'attr': {'class': 'form-control', 'value': persona.numdirec}}) }}
	</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.numdirec, 'Número') }}</div>
	<div class="col col-sm col-md-7 col-lg-4"></div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.referenciadir) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.referenciadir, {'attr': {'class': 'form-control', 'value': persona.referenciadir}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.nombre_comuna) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.nombre_comuna, {'attr': {'class': 'form-control', 'value': persona.nombreComuna}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.fono) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.fono, {'attr': {'class': 'form-control', 'value': persona.fono}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.fono_2) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.fono_2, {'attr': {'class': 'form-control', 'value': persona.fono2}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.email) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.email, {'attr': {'class': 'form-control', 'value': persona.email}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm-3 col-lg-2">{{ form_label(personaForm.sexo) }}</div>
	<div class="col col-sm col-md-7 col-lg-4">{{ form_widget(personaForm.sexo, {'attr': {'class': 'custom-select', 'value': persona.sexo}}) }}</div>
      </div>

      <div class="form-row">
	<div class="col col-sm col-md-10 col-lg-6">
	  <input type="submit" class="btn btn-primary" value="Guardar"/>
	</div>
      </div>
    {{ form_end(personaForm) }}

    <h4>Permisos</h4>

    {{ form_start(permisosForm, {'attr': {'class': 'form-row'}}) }}
      <div class="col-sm-2 text-right">{{ form_label(permisosForm.systems, 'Aplicaciones', {'attr': {'class': 'custom-control-label'}}) }}</div>
      <div class="col-sm-2">{{ form_widget(permisosForm.systems, {'attr': {'class': 'custom-select'}}) }}</div>

      <div class="col-sm-2 text-right">{{ form_label(permisosForm.roles, 'Perfiles', {'attr': {'class': 'custom-control-label '}}) }}</div>
      <div class="col-sm-2">{{ form_widget(permisosForm.roles, {'attr': {'class': 'custom-select'}}) }}</div>

      <div class="col-sm-2"><button class="btn btn-sm btn-success" type="submit" name="send"><i class="fas fa-plus"></i> Agregar</button></div>
    {{ form_end(permisosForm) }}

    <table class="table">
      <thead>
	<tr>
	  <th scope="col">Aplicación</th>
	  <th scope="col">Perfil</th>
	  <th scope="col"></th>
	</tr>
      </thead>
      <tbody>
	{% for per in permisos %}
          <tr data_id="{{ per.idPermiso }}">
	    <td>{{ per.fkApp.nombre }}</td>
	    <td>{{ per.fkFkPerfil.nombre }}</td>
	    <td><a class="btn btn-danger btn-sm delperm" href="{{ url('usuario_delperm', {'id': per.idPermiso}) }}">
	      <i class="fas fa-trash-alt"></i>
	      Eliminar
	    </a></td>
	  </tr>
	{% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}

  <script type="text/javascript">
   $(document).ready( function () {
     $('.delperm').click( function (ev) {
       if (confirm('¿Esta seguro de eliminar este permiso?'))
	 rerutn true

       return false;
     } );
   } );
  </script>
{% endblock %}
